{"version":3,"sources":["jquery.scrolldepth.js"],"names":["factory","define","amd","module","exports","require","jQuery","$","universalGA","classicGA","gaGlobal","globalSiteTag","standardEventHandler","defaults","minHeight","elements","percentage","userTiming","pixelDepth","nonInteraction","gtmOverride","trackerName","dataLayer","$window","window","cache","scrollEventBound","lastPixelDepth","scrollDepth","options","startTime","Date","sendEvent","action","label","scrollDistance","timing","command","event","eventCategory","eventAction","eventLabel","eventValue","eventNonInteraction","arguments","length","rounded","eventTiming","gtag","category","scroll_distance","px_distance","_gaq","push","Math","floor","toString","bindScrollDepth","on","func","wait","later","previous","timeout","result","apply","context","args","now","remaining","this","clearTimeout","setTimeout","throttle","docHeight","document","height","winHeight","innerHeight","scrollTop","marks","25%","parseInt","50%","75%","100%","calculateMarks","off","each","index","elem","inArray","offset","top","checkElements","key","val","checkMarks","extend","ga","__gaTracker","eventHandler","data","reset","addElements","elems","isArray","merge","removeElements","inElementsArray","inCacheArray","splice"],"mappings":"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","file":"jquery.scrolldepth.js","sourcesContent":["/*!\n * @preserve\n * jquery.scrolldepth.js | v1.0\n * Copyright (c) 2016 Rob Flaherty (@robflaherty)\n * Licensed under the MIT and GPL licenses.\n */\n\n/* Universal module definition */\n\n(function(factory) {\n  if (typeof define === 'function' && define.amd) {\n    // AMD\n    define(['jquery'], factory);\n  } else if (typeof module === 'object' && module.exports) {\n    // CommonJS\n    module.exports = factory(require('jquery'));\n  } else {\n    // Browser globals\n    factory(jQuery);\n  }\n}(function($) {\n\n/* Scroll Depth */\n\n    \"use strict\";\n\n    var defaults = {\n      minHeight: 0,\n      elements: [],\n      percentage: true,\n      userTiming: true,\n      pixelDepth: true,\n      nonInteraction: true,\n      gaGlobal: false,\n      gtmOverride: false,\n      trackerName: false,\n      dataLayer: 'dataLayer'\n    };\n\n    var $window = $(window),\n      cache = [],\n      scrollEventBound = false,\n      lastPixelDepth = 0,\n      universalGA,\n      classicGA,\n      gaGlobal,\n      globalSiteTag,\n      standardEventHandler;\n\n    /*\n     * Plugin\n     */\n\n    $.scrollDepth = function(options) {\n\n      var startTime = +new Date;\n\n      options = $.extend({}, defaults, options);\n\n      // Return early if document height is too small\n      if ( $(document).height() < options.minHeight ) {\n        return;\n      }\n\n      /*\n       * Determine which version of GA is being used\n       * \"ga\", \"__gaTracker\", _gaq\", and \"dataLayer\" are the possible globals\n       */\n\n      if (options.gaGlobal) {\n        universalGA = true;\n        gaGlobal = options.gaGlobal;\n      } else if (typeof gtag === \"function\") {\n        globalSiteTag = true;\n        gaGlobal = 'gtag';\n      } else if (typeof ga === \"function\") {\n        universalGA = true;\n        gaGlobal = 'ga';\n      } else if (typeof __gaTracker === \"function\") {\n        universalGA = true;\n        gaGlobal = '__gaTracker';\n      }\n\n      if (typeof _gaq !== \"undefined\" && typeof _gaq.push === \"function\") {\n        classicGA = true;\n      }\n\n      if (typeof options.eventHandler === \"function\") {\n        standardEventHandler = options.eventHandler;\n      } else if (typeof window[options.dataLayer] !== \"undefined\" && typeof window[options.dataLayer].push === \"function\" && !options.gtmOverride) {\n\n        standardEventHandler = function(data) {\n          window[options.dataLayer].push(data);\n        };\n      }\n\n      /*\n       * Functions\n       */\n\n      function sendEvent(action, label, scrollDistance, timing) {\n\n        var command = options.trackerName ? (options.trackerName + '.send') : 'send';\n\n        if (standardEventHandler) {\n\n          standardEventHandler({'event': 'ScrollDistance', 'eventCategory': 'Scroll Depth', 'eventAction': action, 'eventLabel': label, 'eventValue': 1, 'eventNonInteraction': options.nonInteraction});\n\n          if (options.pixelDepth && arguments.length > 2 && scrollDistance > lastPixelDepth) {\n            lastPixelDepth = scrollDistance;\n            standardEventHandler({'event': 'ScrollDistance', 'eventCategory': 'Scroll Depth', 'eventAction': 'Pixel Depth', 'eventLabel': rounded(scrollDistance), 'eventValue': 1, 'eventNonInteraction': options.nonInteraction});\n          }\n\n          if (options.userTiming && arguments.length > 3) {\n            standardEventHandler({'event': 'ScrollTiming', 'eventCategory': 'Scroll Depth', 'eventAction': action, 'eventLabel': label, 'eventTiming': timing});\n          }\n\n          if (globalSiteTag) {\n            gtag('event', 'scroll_depth', {\n              'category': 'Scroll Depth',\n              'scroll_distance': label,\n              'px_distance': scrollDistance\n            });\n          }\n\n        } else {\n\n          if (universalGA) {\n\n            window[gaGlobal](command, 'event', 'Scroll Depth', action, label, 1, {'nonInteraction': options.nonInteraction});\n\n            if (options.pixelDepth && arguments.length > 2 && scrollDistance > lastPixelDepth) {\n              lastPixelDepth = scrollDistance;\n              window[gaGlobal](command, 'event', 'Scroll Depth', 'Pixel Depth', rounded(scrollDistance), 1, {'nonInteraction': options.nonInteraction});\n            }\n\n            if (options.userTiming && arguments.length > 3) {\n              window[gaGlobal](command, 'timing', 'Scroll Depth', action, timing, label);\n            }\n\n          }\n\n          if (classicGA) {\n\n            _gaq.push(['_trackEvent', 'Scroll Depth', action, label, 1, options.nonInteraction]);\n\n            if (options.pixelDepth && arguments.length > 2 && scrollDistance > lastPixelDepth) {\n              lastPixelDepth = scrollDistance;\n              _gaq.push(['_trackEvent', 'Scroll Depth', 'Pixel Depth', rounded(scrollDistance), 1, options.nonInteraction]);\n            }\n\n            if (options.userTiming && arguments.length > 3) {\n              _gaq.push(['_trackTiming', 'Scroll Depth', action, timing, label, 100]);\n            }\n\n          }\n\n        }\n\n      }\n\n      function calculateMarks(docHeight) {\n        return {\n          '25%' : parseInt(docHeight * 0.25, 10),\n          '50%' : parseInt(docHeight * 0.50, 10),\n          '75%' : parseInt(docHeight * 0.75, 10),\n          // Cushion to trigger 100% event in iOS\n          '100%': docHeight - 5\n        };\n      }\n\n      function checkMarks(marks, scrollDistance, timing) {\n        // Check each active mark\n        $.each(marks, function(key, val) {\n          if ( $.inArray(key, cache) === -1 && scrollDistance >= val ) {\n            sendEvent('Percentage', key, scrollDistance, timing);\n            cache.push(key);\n          }\n        });\n      }\n\n      function checkElements(elements, scrollDistance, timing) {\n        $.each(elements, function(index, elem) {\n          if ( $.inArray(elem, cache) === -1 && $(elem).length ) {\n            if ( scrollDistance >= $(elem).offset().top ) {\n              sendEvent('Elements', elem, scrollDistance, timing);\n              cache.push(elem);\n            }\n          }\n        });\n      }\n\n      function rounded(scrollDistance) {\n        // Returns String\n        return (Math.floor(scrollDistance/250) * 250).toString();\n      }\n\n      function init() {\n        bindScrollDepth();\n      }\n\n      /*\n       * Public Methods\n       */\n\n      // Reset Scroll Depth with the originally initialized options\n      $.scrollDepth.reset = function() {\n        cache = [];\n        lastPixelDepth = 0;\n        $window.off('scroll.scrollDepth');\n        bindScrollDepth();\n      };\n\n      // Add DOM elements to be tracked\n      $.scrollDepth.addElements = function(elems) {\n\n        if (typeof elems == \"undefined\" || !$.isArray(elems)) {\n          return;\n        }\n\n        $.merge(options.elements, elems);\n\n        // If scroll event has been unbound from window, rebind\n        if (!scrollEventBound) {\n          bindScrollDepth();\n        }\n\n      };\n\n      // Remove DOM elements currently tracked\n      $.scrollDepth.removeElements = function(elems) {\n\n        if (typeof elems == \"undefined\" || !$.isArray(elems)) {\n          return;\n        }\n\n        $.each(elems, function(index, elem) {\n\n          var inElementsArray = $.inArray(elem, options.elements);\n          var inCacheArray = $.inArray(elem, cache);\n\n          if (inElementsArray != -1) {\n            options.elements.splice(inElementsArray, 1);\n          }\n\n          if (inCacheArray != -1) {\n            cache.splice(inCacheArray, 1);\n          }\n\n        });\n\n      };\n\n      /*\n       * Throttle function borrowed from:\n       * Underscore.js 1.5.2\n       * http://underscorejs.org\n       * (c) 2009-2013 Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors\n       * Underscore may be freely distributed under the MIT license.\n       */\n\n      function throttle(func, wait) {\n        var context, args, result;\n        var timeout = null;\n        var previous = 0;\n        var later = function() {\n          previous = new Date;\n          timeout = null;\n          result = func.apply(context, args);\n        };\n        return function() {\n          var now = new Date;\n          if (!previous) previous = now;\n          var remaining = wait - (now - previous);\n          context = this;\n          args = arguments;\n          if (remaining <= 0) {\n            clearTimeout(timeout);\n            timeout = null;\n            previous = now;\n            result = func.apply(context, args);\n          } else if (!timeout) {\n            timeout = setTimeout(later, remaining);\n          }\n          return result;\n        };\n      }\n\n      /*\n       * Scroll Event\n       */\n\n      function bindScrollDepth() {\n\n        scrollEventBound = true;\n\n        $window.on('scroll.scrollDepth', throttle(function() {\n          /*\n           * We calculate document and window height on each scroll event to\n           * account for dynamic DOM changes.\n           */\n\n          var docHeight = $(document).height(),\n            winHeight = window.innerHeight ? window.innerHeight : $window.height(),\n            scrollDistance = $window.scrollTop() + winHeight,\n\n            // Recalculate percentage marks\n            marks = calculateMarks(docHeight),\n\n            // Timing\n            timing = +new Date - startTime;\n\n          // If all marks already hit, unbind scroll event\n          if (cache.length >= options.elements.length + (options.percentage ? 4:0)) {\n            $window.off('scroll.scrollDepth');\n            scrollEventBound = false;\n            return;\n          }\n\n          // Check specified DOM elements\n          if (options.elements) {\n            checkElements(options.elements, scrollDistance, timing);\n          }\n\n          // Check standard marks\n          if (options.percentage) {\n            checkMarks(marks, scrollDistance, timing);\n          }\n        }, 500));\n\n      }\n\n      init();\n\n    };\n\n    // UMD export\n    return $.scrollDepth;\n\n}));\n"]}