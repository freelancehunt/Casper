!function(i){"function"==typeof define&&define.amd?define(["jquery"],i):"object"==typeof module&&module.exports?module.exports=i(require("jquery")):i(jQuery)}(function(p){var v={fields:[],percentOnScreen:"50%",reportInterval:10,googleAnalytics:!1,callback:function(){}};p.screentime=function(n){(n=p.extend({},v,n)).percentOnScreen=parseInt(n.percentOnScreen.replace("%",""),10);var s,o,c={},h={},l={},i=null,t=!1;function r(i){this.selector=i.selector,$elem=this.$elem=p(i.selector),this.name=i.name,this.top=$elem.offset().top,this.height=$elem.height(),this.bottom=this.top+this.height,this.width=$elem.width()}function a(){var i=p(window);this.top=i.scrollTop(),this.height=i.height(),this.bottom=this.top+this.height,this.width=i.width()}function e(){var e=new a;p.each(h,function(i,t){!function(i,t){var e;return t.bottom<=i.bottom&&t.top>=i.top||t.height>i.height&&i.bottom-t.top>i.height/2&&t.bottom-i.top>i.height/2||(e=t.height*(n.percentOnScreen/100),i.bottom-e>=t.top&&t.bottom-e>i.top)}(e,t)||(l[i]+=1,c[i]+=1)})}function f(){var e={};p.each(c,function(i,t){0<t&&(e[i]=t,c[i]=0,n.googleAnalytics&&function(i,t){s&&ga("send","event","Screentime","Time on Screen",i,parseInt(t,10),{nonInteraction:!0}),o&&_gaq.push(["_trackEvent","Screentime","Time on Screen",i,parseInt(t,10),!0])}(i,t))}),p.isEmptyObject(e)||n.callback.call(this,e,l)}function u(){t||(e(),t=!0),i=setInterval(function(){e()},1e3),reporter=setInterval(function(){f()},1e3*n.reportInterval)}function d(){clearInterval(i),clearInterval(reporter)}n.fields.length&&(n.googleAnalytics&&("function"==typeof ga&&(s=!0),"undefined"!=typeof _gaq&&"function"==typeof _gaq.push&&(o=!0)),function(){window.visibly={q:document,p:void 0,prefixes:["webkit","ms","o","moz","khtml"],props:["VisibilityState","visibilitychange","Hidden"],m:["focus","blur"],visibleCallbacks:[],hiddenCallbacks:[],genericCallbacks:[],_callbacks:[],cachedPrefix:"",fn:null,onVisible:function(i){"function"==typeof i&&this.visibleCallbacks.push(i)},onHidden:function(i){"function"==typeof i&&this.hiddenCallbacks.push(i)},getPrefix:function(){if(!this.cachedPrefix)for(var i=0;b=this.prefixes[i++];)if(b+this.props[2]in this.q)return this.cachedPrefix=b,this.cachedPrefix},visibilityState:function(){return this._getProp(0)},hidden:function(){return this._getProp(2)},visibilitychange:function(i){"function"==typeof i&&this.genericCallbacks.push(i);var t=this.genericCallbacks.length;if(t)if(this.cachedPrefix)for(;t--;)this.genericCallbacks[t].call(this,this.visibilityState());else for(;t--;)this.genericCallbacks[t].call(this,i)},isSupported:function(i){return this.cachedPrefix+this.props[2]in this.q},_getProp:function(i){return this.q[this.cachedPrefix+this.props[i]]},_execute:function(i){if(i){this._callbacks=1==i?this.visibleCallbacks:this.hiddenCallbacks;for(var t=this._callbacks.length;t--;)this._callbacks[t]()}},_visible:function(){window.visibly._execute(1),window.visibly.visibilitychange.call(window.visibly,"visible")},_hidden:function(){window.visibly._execute(2),window.visibly.visibilitychange.call(window.visibly,"hidden")},_nativeSwitch:function(){this[this._getProp(2)?"_hidden":"_visible"]()},_listen:function(){try{this.isSupported()?this.q.addEventListener(this.cachedPrefix+this.props[1],function(){window.visibly._nativeSwitch.apply(window.visibly,arguments)},1):this.q.addEventListener?(window.addEventListener(this.m[0],this._visible,1),window.addEventListener(this.m[1],this._hidden,1)):this.q.attachEvent&&(this.q.attachEvent("onfocusin",this._visible),this.q.attachEvent("onfocusout",this._hidden))}catch(i){}},init:function(){this.getPrefix(),this._listen()}},this.visibly.init()}(),p.screentime.reset=function(){d(),p.each(h,function(i,t){l[i]=0,c[i]=0}),u()},p.each(n.fields,function(i,t){if(p(t.selector).length){var e=new r(t);h[e.name]=e,c[e.name]=0,l[e.name]=0}}),u(),visibly.onHidden(function(){d()}),visibly.onVisible(function(){d(),u()}))}});
//# sourceMappingURL=screentime.js.map